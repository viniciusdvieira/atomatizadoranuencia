<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerador de Documentos</title>
  <style>
    body { font-family: Calibri, sans-serif; background-color: #f5f5f5; padding: 30px; }
    .tabs { display: flex; margin-bottom: 20px; }
    .tabs button { flex: 1; padding: 10px; cursor: pointer; background-color: #e0e0e0; border: none; font-weight: bold; }
    .tabs button.active { background-color: #2c7be5; color: white; }
    .tab-content { display: none; }
    .tab-content.active {
      display: block; background-color: white; padding: 30px; border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,.1); max-width: 700px; margin: auto;
    }
    h2 { text-align: center; margin-bottom: 20px; }
    label { display: block; margin: 10px 0 5px; }
    input, select {
      width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;
    }
    button[type="submit"] {
      margin-top: 20px; width: 100%; padding: 12px; background-color: #2c7be5; color: white;
      border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer;
    }
    .output-box {
      margin-top: 16px; display: none;
    }
    .output-actions {
      display: flex; gap: 10px; justify-content: flex-end; margin-bottom: 6px;
    }
    .output-actions button {
      padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;
      background: #e9ecef;
    }
    textarea.preview {
      width: 100%; min-height: 380px; white-space: pre-wrap; font-family: "Courier New", monospace;
      border: 1px solid #ccc; border-radius: 6px; padding: 12px; background: #fafafa;
    }
    .toast {
      position: fixed; right: 24px; top: 24px; background: #2c7be5; color: #fff;
      padding: 10px 14px; border-radius: 8px; font-weight: 700; box-shadow: 0 8px 24px rgba(0,0,0,.15);
      opacity: 0; transform: translateY(-8px); pointer-events: none; transition: all .25s ease;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
  </style>
</head>
<body>
  <div class="tabs">
    <button type="button" class="active" onclick="switchTab(0)">Termo de Anuência</button>
    <button type="button" onclick="switchTab(1)">Termo Aditivo de Rescisão</button>
  </div>

  <!-- Termo de Anuência -->
  <div class="tab-content active">
    <h2>Gerar Termo de Anuência</h2>
    <form id="termoForm">
      <label>Número do Processo:</label><input name="processo" required>
      <label>Nome:</label><input name="nome" required>
      <label>Valor Total:</label><input name="valor" type="number" step="0.01" required>
      <label>Nº de Prestações:</label><input name="numPrestacoes" type="number" required>
      <button type="submit">Gerar Documento</button>
    </form>
  </div>

  <!-- Termo Aditivo de Rescisão (gera texto na tela) -->
  <div class="tab-content">
    <h2>Gerar Termo Aditivo de Rescisão</h2>
    <form id="aditivoForm">
      <label>Tipo de Contrato:</label>
      <select name="tipoContrato" required>
        <option value="">Selecione</option>
        <option value="PRESTAÇÃO DE SERVIÇOS">PRESTAÇÃO DE SERVIÇOS</option>
        <option value="FORNECIMENTO DE BENS">FORNECIMENTO DE BENS</option>
      </select>

      <label>Razão Social da Contratada:</label><input name="razaoSocialContratada" required>
      <label>CNPJ da Contratada:</label><input name="cnpjContratada" required>
      <label>Endereço Completo:</label><input name="enderecoContratada" required>
      <label>Nº do Contrato (ex.: X/AAAA):</label><input name="numeroContrato" required>
      <label>Data de Assinatura do Contrato:</label><input name="dataAssinaturaContrato" type="date" required>
      <label>Objeto do Contrato (descrição):</label><input name="objetoOriginal" required>

      <button type="submit">Gerar Texto</button>
    </form>

    <!-- Saída do texto gerado -->
    <div id="aditivoOutputBox" class="output-box">
      <div class="output-actions">
        <button type="button" onclick="copiarAditivo()">Copiar texto</button>
      </div>
      <textarea id="aditivoOutput" class="preview" readonly></textarea>
    </div>
  </div>

  <script>
    function switchTab(index) {
      document.querySelectorAll('.tab-content').forEach((tab, i) => {
        tab.classList.toggle('active', i === index);
      });
      document.querySelectorAll('.tabs button').forEach((btn, i) => {
        btn.classList.toggle('active', i === index);
      });
    }

    // ---- Termo de Anuência (continua baixando DOCX do backend) ----
    document.getElementById('termoForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = e.target;
      const dados = {
        processo: form.processo.value,
        nome: form.nome.value,
        valor: form.valor.value,
        numPrestacoes: form.numPrestacoes.value
      };

      const response = await fetch('/gerar-termo', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dados)
      });

      const blob = await response.blob();
      const url = URL.createObjectURL(blob);
      const nomeSanitizado = dados.nome.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, "_");
      const a = document.createElement('a');
      a.href = url;
      a.download = `Termo_Anuencia_${nomeSanitizado}.docx`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // ---- Termo Aditivo de Rescisão (gera texto no front) ----
    document.getElementById('aditivoForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const form = e.target;

      const tipoContrato = form.tipoContrato.value; // PRESTAÇÃO DE SERVIÇOS | FORNECIMENTO DE BENS
      const razaoSocialContratada = form.razaoSocialContratada.value;
      const cnpjContratada = form.cnpjContratada.value;
      const enderecoContratada = form.enderecoContratada.value;
      const numeroContrato = form.numeroContrato.value;
      const dataAssinaturaContrato = form.dataAssinaturaContrato.value; // YYYY-MM-DD
      const objetoOriginal = form.objetoOriginal.value;

      // Data para exibir no padrão DD/MM/AAAA
      const dataBR = dataAssinaturaContrato
        ? new Date(dataAssinaturaContrato + "T00:00:00").toLocaleDateString('pt-BR')
        : "[DATA]";

      // Monta exatamente o texto que você especificou
      const texto = 
`TERMO ADITIVO AO CONTRATO Nº
${numeroContrato} DE ${tipoContrato},
VISANDO A RESCISÃO
ADMINISTRATIVA UNILATERAL.
Pelo presente instrumento, a ÁGUAS E ESGOTOS DO PIAUÍ S.A. – AGESPISA, sociedade de
economia mista estadual, inscrita no CNPJ sob o nº 06.845.747/0001-27, com sede na Av. Mal.
Castelo Branco, Nº 101/N, Bairro Cabral, na cidade de Teresina-PI, neste ato representada por
seu Diretor-Presidente, GARCIAS GUEDES RODRIGUES JÚNIOR, doravante denominada
simplesmente CONTRATANTE; frente a empresa ${razaoSocialContratada} ,
inscrita no CNPJ sob o nº ${cnpjContratada}, com sede na ${enderecoContratada}, doravante denominada
CONTRATADA, unilateralmente resolve celebrar o presente Termo Aditivo de Rescisão
Unilateral, com fundamento no artigo 137, inciso VIII, da Lei nº 14.133, de 1º de abril de 2021,
mediante as cláusulas e condições a seguir pactuadas:
CLÁUSULA PRIMEIRA – DO OBJETO
1.1 O presente Termo Aditivo tem por objeto a rescisão unilateral do Contrato nº ${numeroContrato},
celebrado em ${dataBR}, cujo objeto consiste em ${objetoOriginal}, em razão da superveniência de razões de interesse público, consistentes na
extinção da função operacional da AGESPISA e na preparação para sua liquidação societária,
conforme autorizado pela Lei Complementar nº 319, de 16 de julho de 2025 .`;

      const box = document.getElementById('aditivoOutputBox');
      const out = document.getElementById('aditivoOutput');
      out.value = texto;
      box.style.display = 'block';
      out.scrollIntoView({ behavior: 'smooth' });
    });

    // Toast popup
    function showToast(msg = "Texto copiado!") {
      let t = document.getElementById('toast');
      if (!t) {
        t = document.createElement('div');
        t.id = 'toast';
        t.className = 'toast';
        document.body.appendChild(t);
      }
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 1800);
    }

    function copiarAditivo() {
      const out = document.getElementById('aditivoOutput');
      out.select();
      out.setSelectionRange(0, out.value.length);
      const ok = document.execCommand('copy');
      showToast(ok ? "Texto copiado!" : "Falha ao copiar");
    }
  </script>
  <div id="toast" class="toast" aria-live="polite"></div>
</body>
</html>
